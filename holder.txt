using Dungeon.Logics.StartBonus;
using MainUI;
using System.Collections.Generic;
using UnityEngine;


public static void UpdateCustomPortrait(FormationSwitchablePersonalityUIScrollView view)
{
    for (int i = 0; i < view._itemList.Count; i++)
    {
        UIScrollViewItem<IPersonality> currentItem = view._itemList[i];
        if (view._portraitDict.TryGetValue(currentItem.Data.GetID(), out Sprite newSprite) && newSprite == null)
        {
            (view.GetItemByPersonalityId(currentItem.Data.GetID()) as FormationSwitchablePersonalityUIScrollViewItem).SetStaticData(currentItem.Data.GetClassInfo(), currentItem.Data.GetLevel(), currentItem.Data.GetSyncLevel(), currentItem.Data.CheckGacksungIllust());
            view._portraitDict[currentItem.Data.GetID()] = Singleton<CharacterIllustDataMediator>.Instance.GetPortraitSprite(currentItem.Data.GetClassInfo(), currentItem.Data.GetSyncLevel(), currentItem.Data.CheckGacksungIllust());
        }
    }
}


[HarmonyPatch(typeof(FormationSwitchablePersonalityUIScrollView), nameof(FormationSwitchablePersonalityUIScrollView.UpdateUI))]
[HarmonyPostfix]
public static void Postfix_FormationSwitchablePersonalityUIScrollView_UpdateUI(FormationSwitchablePersonalityUIScrollView __instance)
{
    UpdateCustomPortrait(__instance);
}

[HarmonyPatch(typeof(FormationSwitchablePersonalityUIScrollView), nameof(FormationSwitchablePersonalityUIScrollView.SetData))]
[HarmonyPostfix]
public static void Postfix_FormationSwitchablePersonalityUIScrollView_SetData(System.Collections.Generic.IList<IPersonality> list, Il2CppSystem.Func<PersonalityStaticData, bool> selectedGetter, DungeonStartBonusCalculator dungeonStartBonusCalculator, Il2CppSystem.Action<FormationSwitchablePersonalityUIScrollViewItem, bool> afterSelectEvent, RestrictParticipationData restrictData, FormationOpenTypes openTypes, Il2CppSystem.Func<PersonalityStaticData, FormationPersonalityUI_LabelModel> labelModelGetter, bool isUpdateWithoutChangeScroll, FormationSwitchablePersonalityUIScrollView __instance)
{
    UpdateCustomPortrait(__instance);
}